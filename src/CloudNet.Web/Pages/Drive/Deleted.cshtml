@page
@model CloudNet.Web.Pages.Drive.DeletedModel
@{
    ViewData["Title"] = "Deleted items";
}

@if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
{
    <div class="alert alert-danger" role="alert">@Model.ErrorMessage</div>
}

<div class="alert alert-warning" role="alert">
    Purging permanently removes files and reduces your storage quota. This action cannot be undone.
</div>

<div class="row g-3">
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <h2 class="h5 mb-3">Deleted folders</h2>
                @if (!Model.DeletedFolders.Any())
                {
                    <p class="text-muted">No deleted folders.</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var folder in Model.DeletedFolders)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="fw-semibold">@folder.Name</div>
                                    <div class="text-muted small">Deleted @folder.ModifiedAt?.ToLocalTime().ToString("g")</div>
                                </div>
                                <form method="post" asp-page-handler="RestoreFolder">
                                    <input type="hidden" name="folderId" value="@folder.Id" />
                                    <button class="btn btn-sm btn-outline-success" type="submit">Restore</button>
                                </form>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <h2 class="h5 mb-3">Deleted files</h2>
                @if (!Model.DeletedFiles.Any())
                {
                    <p class="text-muted">No deleted files.</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var file in Model.DeletedFiles)
                        {
                            <li class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">@file.FileName</div>
                                        <div class="text-muted small">Deleted @file.ModifiedAt?.ToLocalTime().ToString("g")</div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <form method="post" asp-page-handler="RestoreFile">
                                            <input type="hidden" name="fileId" value="@file.Id" />
                                            <button class="btn btn-sm btn-outline-success" type="submit">Restore</button>
                                        </form>
                                        <form method="post" asp-page-handler="PurgeFile" onsubmit="return confirm('Permanently delete this file?');">
                                            <input type="hidden" name="fileId" value="@file.Id" />
                                            <button class="btn btn-sm btn-outline-danger" type="submit">Purge</button>
                                        </form>
                                    </div>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>
</div>
